# Auto Map Presets

using(core="49f5f503-1c00-4f24-ba43-92e65c2c2fb6")

bbcode = """
[url=https://ibb.co/TW0G3zm][img]https://i.ibb.co/y4kCjLW/Arena-of-Earth-Desert-Day-32x24.jpg[/img][/url]
[url=https://ibb.co/KxbXvj7][img]https://i.ibb.co/yFdXjn5/Arena-of-Earth-Desert-Night-32x24.jpg[/img][/url]
[url=https://ibb.co/h87YZkY][img]https://i.ibb.co/s3mW6hW/Arena-of-Earth-Jade-Day-32x24.jpg[/img][/url]
[url=https://ibb.co/wLLbXvd][img]https://i.ibb.co/PYYbnSr/Arena-of-Earth-Jade-Day-Retracted-Stairs-Overlay-22x22.jpg[/img][/url]
[url=https://ibb.co/r4nZSNZ][img]https://i.ibb.co/PwB5n05/Beach-Dunes-32x22.jpg[/img][/url]
[url=https://ibb.co/Jzk5ghD][img]https://i.ibb.co/1928jSF/Crab-Rock-Seaside-Clear-31x23.jpg[/img][/url]
[url=https://ibb.co/1Qxrqx1][img]https://i.ibb.co/NCz9jz5/Crab-Rock-Seaside-Dreary-31x23.jpg[/img][/url]
[url=https://ibb.co/zXph82q][img]https://i.ibb.co/F52bsYR/Crystal-Hill-25x17.jpg[/img][/url]
[url=https://ibb.co/YdkQNLf][img]https://i.ibb.co/8x5sm7P/Desert-Island-Tropical-Day-31x23.jpg[/img][/url]
[url=https://ibb.co/28sWx1B][img]https://i.ibb.co/5YnGmgV/Desert-Island-Tropical-Night-31x23.jpg[/img][/url]
[url=https://ibb.co/JRZ7xF0][img]https://i.ibb.co/hR0WX1h/Desert-Crossroads-Gridded-32x21-Map-Public.jpg[/img][/url]
[url=https://ibb.co/GkNRynS][img]https://i.ibb.co/DkTQhz2/Desert-Oasis-25x17.jpg[/img][/url]
[url=https://ibb.co/HP0WHpT][img]https://i.ibb.co/gWG5RFZ/Fallen-Star-Fallen-Star-Day-31x23.jpg[/img][/url]
[url=https://ibb.co/xYGP0dH][img]https://i.ibb.co/jzGB2sR/Fallen-Star-Fallen-Star-Night-31x23.jpg[/img][/url]
[url=https://ibb.co/cwHBJZb][img]https://i.ibb.co/bFZ01CH/Fighting-Pit-Muddy-Dark-16x10.jpg[/img][/url]
[url=https://ibb.co/TYZ5BfR][img]https://i.ibb.co/ckPdcBt/Fighting-Pit-Muddy-Light-27x18.jpg[/img][/url]
[url=https://ibb.co/QfDRW0s][img]https://i.ibb.co/KXKktnC/Green-Hill-Old-Oak-Day-32x22.jpg[/img][/url]
[url=https://ibb.co/m8WP5p4][img]https://i.ibb.co/FVTd4pz/Green-Hill-Old-Oak-Day-Canopy-32x22.jpg[/img][/url]
[url=https://ibb.co/cbt4BrT][img]https://i.ibb.co/FsJRrD7/Green-Hill-Old-Oak-Night-32x22.jpg[/img][/url]
[url=https://ibb.co/qdNLyQm][img]https://i.ibb.co/37p5rZS/Green-Hill-Old-Oak-Night-Canopy-32x22.jpg[/img][/url]
[url=https://ibb.co/hX4vtyV][img]https://i.ibb.co/B4QRStB/Greybanner-Coliseum-Day-Large-31x23.jpg[/img][/url]
[url=https://ibb.co/SXPg6tx][img]https://i.ibb.co/Rp9Kg3S/Greybanner-Coliseum-Day-Small-22x16.jpg[/img][/url]
[url=https://ibb.co/WcxKM9g][img]https://i.ibb.co/qRy1cGk/Haunted-Marsh-26x18.jpg[/img][/url]
[url=https://ibb.co/7YCTjgy][img]https://i.ibb.co/0D2WmBJ/Hillside-Altar-26x18.jpg[/img][/url]
[url=https://ibb.co/xCY248P][img]https://i.ibb.co/r73QWfT/Hillside-Cave-26x19.jpg[/img][/url]
[url=https://ibb.co/DMJzKby][img]https://i.ibb.co/6tMrsZx/Jungle-River-Crossing-Lily-Field-Day-23x16.jpg[/img][/url]
[url=https://ibb.co/gd5qtgH][img]https://i.ibb.co/9hFKyYz/Jungle-River-Crossing-Lily-Field-Night-23x16.jpg[/img][/url]
[url=https://ibb.co/8D9L3XH][img]https://i.ibb.co/7JKdcbq/Lakebed-Monolith-26x18.jpg[/img][/url]
[url=https://ibb.co/sjRX6Hm][img]https://i.ibb.co/LSRsJ5k/Ocean-calm-16x16.jpg[/img][/url]
[url=https://ibb.co/k6k5Y3G][img]https://i.ibb.co/Z1tGyHf/Ocean-nighttime-16x16.jpg[/img][/url]
[url=https://ibb.co/L9R6wjS][img]https://i.ibb.co/6Dwbh9Y/Ocean-rough-16x16.jpg[/img][/url]
[url=https://ibb.co/fGGDFNG][img]https://i.ibb.co/7NNkCpN/Ocean-storm-16x16.jpg[/img][/url]
[url=https://ibb.co/FhGjdRg][img]https://i.ibb.co/nwh5Kxz/Ocean-tropical-16x16.jpg[/img][/url]
[url=https://ibb.co/qrwWPwj][img]https://i.ibb.co/4VxY5xt/Pumpkin-Hill-26x18.jpg[/img][/url]
[url=https://ibb.co/HY9r0Y2][img]https://i.ibb.co/J2SzN2d/Roadside-Rise-26x20.jpg[/img][/url]
[url=https://ibb.co/m63dq69][img]https://i.ibb.co/qkvhskN/Shattered-Sky-Astral-Blue-Star-Background-22x16.jpg[/img][/url]
[url=https://ibb.co/XjqfPCr][img]https://i.ibb.co/zQzWg4T/Shattered-Sky-Astral-Red-Star-Background-22x16.jpg[/img][/url]
[url=https://ibb.co/VNQDkT0][img]https://i.ibb.co/7zRV0Kx/Shattered-Sky-Astral-Sea-Blue-Star-22x16.jpg[/img][/url]
[url=https://ibb.co/TRjdMTM][img]https://i.ibb.co/mtZg5B5/Shattered-Sky-Astral-Sea-Red-Star-22x16.jpg[/img][/url]
[url=https://ibb.co/qxwPXQD][img]https://i.ibb.co/mS7M1WR/Shifting-Swamp-Jungle-26x18.jpg[/img][/url]
[url=https://ibb.co/y4Xd3yh][img]https://i.ibb.co/0scmwMB/Shifting-Swamp-26x18.jpg[/img][/url]
[url=https://ibb.co/y859r1w][img]https://i.ibb.co/WcFhLwb/Silent-Snowy-Cemetery-26x18.jpg[/img][/url]
[url=https://ibb.co/ZK0FL8J][img]https://i.ibb.co/NpMJVj3/Sinister-Woodland-Swamp-Day-Closed-31x23.jpg[/img][/url]
[url=https://ibb.co/kHCZN9n][img]https://i.ibb.co/6nCQj1h/Sinister-Woodland-Swamp-Day-Open-31x23.jpg[/img][/url]
[url=https://ibb.co/q5xG7m3][img]https://i.ibb.co/GTFwnC4/Sinister-Woodland-Swamp-Night-Closed-31x23.jpg[/img][/url]
[url=https://ibb.co/bQgRFJW][img]https://i.ibb.co/4KZg2dm/Sinister-Woodland-Swamp-Night-Open-31x23.jpg[/img][/url]
[url=https://ibb.co/y8mQLt2][img]https://i.ibb.co/JzWsXVZ/Winter-Wilderness-Lonely-Oak-Day-A-25x18.jpg[/img][/url]
[url=https://ibb.co/FmZftmS][img]https://i.ibb.co/BcW7RcX/Winter-Wilderness-Lonely-Oak-Day-B-25x18.jpg[/img][/url]
[url=https://ibb.co/3Nn9wyC][img]https://i.ibb.co/QN43ZFK/Winter-Wilderness-Lonely-Oak-Night-A-25x18.jpg[/img][/url]
[url=https://ibb.co/PWNMF7m][img]https://i.ibb.co/4S72K6m/Winter-Wilderness-Lonely-Oak-Night-B-25x18.jpg[/img][/url]
"""


def extract_map_info(bb=bbcode):
    map_dict = {}
    custom_sizes = {
        "Arena Of Earth Desert Day": "16x12",
        "Arena Of Earth Desert Night": "16x12",
        "Arena Of Earth Jade Day": "16x12",
        "Arena Of Earth Jade Day Retracted Stairs Overlay": "16x16",
        "Ocean Calm": "16x16",
        "Ocean Nighttime": "16x16",
        "Ocean Rough": "16x16",
        "Ocean Storm": "16x16",
        "Ocean Tropical": "16x16",
        "Desert Crossroads Gridded Map Public": "16x10",
        "Fighting Pit Muddy Dark": "16x9",
        "Fighting Pit Muddy Light": "27x18",
        "Roadside Rise": "16x12",
    }
    for line in bbcode.split("\n"):
        if line == "":
            continue
        url = line.split("[img]")[1].split("[/img]")[0]
        bbp = "".join(url.split("/")[-1].split(".")[:-1]).split("-")
        sizes = [p for p in bbp if "x" in p and all(s.isdigit() for s in p.split("x"))]
        name = " ".join([p for p in bbp if p not in sizes]).title()
        
        # Use custom size if available, otherwise use size from URL or default
        if name in custom_sizes:
            size = custom_sizes[name]
        elif len(sizes) >= 1:
            url_width, url_height = core.map(int, sizes[0].split("x"))
            if url_width < 16 or url_height < 11:
                size = sizes[0]  # Use URL size if lesser than 16x11
            else:
                size = "16x11"  # Use standard size
        else:
            size = "16x11"  # Default size
        
        cell_pixel = get_cell_pixel(size, name)
        map_dict[name] = {"cell_pixel": cell_pixel, "size": size, "image": url}
    return map_dict


def get_cell_pixel(size, map_name):
    return "c40"


map_presets = extract_map_info()


def initialize_map(map_name, map_state):
    if map_name in map_presets:
        map_state["current_map"] = map_name
        map_state["size"] = map_presets[map_name]["size"]
        map_state["mapoptions"] = map_presets[map_name]["cell_pixel"]
        map_state["bg_image"] = map_presets[map_name]["image"]
        return map_state["size"], map_state["bg_image"], map_state["mapoptions"]
    return None, None, None


def find_map_by_subtext(subtext):
    subtext_l = subtext.lower()
    matches = [name for name in map_presets if subtext_l in name.lower()]
    matches = core.bubble_sort(matches)
    name, data = "", None
    if 0 < len(matches):
        name, data = matches[0], map_presets[matches[0]]
    return name, data, matches


def generate_list_embeds(footer):
    pref, al = ctx.prefix, ctx.alias
    cmd = pref + al
    # Generate the list of map options
    map_list = [f'**{m}** ({map_presets[m]["size"]})' for m in map_presets]
    map_list = core.bubble_sort(map_list)
    map_list.append(
        f'\n__Usage Example__:\n`{cmd} map \\"Silent Snowy Cemetery\\"`\n(or)\n`{cmd} m sil`\n\n**Map-Art Courtesy of**:\n[2-Minute Tabletop](https://2minutetabletop.com/) under the [CC BY-NC 4.0 License](https://creativecommons.org/licenses/by-nc/4.0/)\nFeel free to check their other maps if you like this type of map art!'
    )

    # Split the list into chunks of 20 maps each
    chunk_size = 60
    chunks = [map_list[i : i + chunk_size] for i in range(0, len(map_list), chunk_size)]
    return [
        (
            f'{pref}embed -title "Available Map Presets (Page {i+1}/{len(chunks)})" -desc "'
            + "\n".join(chunk)
            + f'" -footer "{footer}"'
        )
        for i, chunk in enumerate(chunks)
    ]
